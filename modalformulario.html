<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro Cliente | Anmago Store</title>
  <meta name="description" content="Completa tu registro de cliente para realizar pedidos en Anmago Store">
  
  <!-- Preconexiones optimizadas -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://ik.imagekit.io">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- PWA y favicon -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="logo.jpg" type="image/x-icon" />

  <!-- Bootstrap e iconos -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

  <!-- CSS optimizado -->
  <link rel="stylesheet" href="ESTILO.CSS?v=20251115" />
</head>
<body class="bg-light">

  <!-- HEADER STICKY -->
  <div id="header-container"></div>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="container py-4 mt-5">
    <h2 class="mb-4 text-center">Registro Cliente</h2>

    <form id="formCliente" class="bg-white p-4 rounded shadow-sm">
      <!-- ‚úÖ CAMPO OCULTO CON NAME PARA GOOGLE SHEETS -->
      <input type="hidden" id="clienteId" name="clienteId">

      <!-- Celular principal -->
      <div class="mb-3">
        <label for="telefonoCliente" class="form-label fw-bold">Celular <span class="text-danger">*</span></label>
        <input type="tel" class="form-control" id="telefonoCliente" name="telefonoCliente" 
               placeholder="Ej: 3001234567" maxlength="10" required autofocus>
        <div class="form-text">Debe comenzar por 3 y tener 10 d√≠gitos.</div>
      </div>

      <!-- Nombre -->
      <div class="mb-3">
        <label for="nombreCliente" class="form-label fw-bold">Nombres y Apellidos <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="nombreCliente" name="nombreCliente" disabled>
      </div>

      <!-- Direcci√≥n Completa -->
      <div class="mb-3">
        <label for="DireccionCompleta" class="form-label fw-bold">Direcci√≥n Completa <span class="text-danger">*</span></label>
        <textarea id="DireccionCompleta" class="form-control" name="DireccionCompleta" 
                  rows="2" maxlength="200" placeholder="Ej: calle, carrera, avenida, transversal, etc." disabled></textarea>
        <div class="form-text">Recuerda colocar tu direcci√≥n exacta para evitar contratiempos en tu entrega.</div>
      </div>

      <!-- Tipo de Unidad y N√∫mero -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="tipoUnidad" class="form-label fw-bold">Tipo de unidad</label>
          <select id="tipoUnidad" class="form-select" name="tipoUnidad" disabled>
            <option value="">Selecciona</option>
            <option value="Casa">CASA</option>
            <option value="Apartamento">APARTAMENTO</option>
            <option value="Piso">PISO</option>
            <option value="Bodega">BODEGA</option>
            <option value="Interior">INTERIOR</option>
          </select>
        </div>
        <div class="col-md-6">
          <label for="numeroApto" class="form-label fw-bold">N√∫mero</label>
          <input type="text" class="form-control" id="numeroApto" name="numeroApto" 
                 maxlength="4" inputmode="numeric" pattern="\d{1,4}" title="Solo n√∫meros entre 0 y 9999" disabled>
        </div>
      </div>

      <!-- Barrio -->
      <div class="mb-3">
        <label for="barrio" class="form-label fw-bold">Barrio (opcional)</label>
        <input type="text" class="form-control" id="barrio" name="barrio" maxlength="50" disabled>
      </div>

      <!-- Observaci√≥n adicional -->
      <div class="mb-3">
        <label for="observacionDireccion" class="form-label fw-bold">Punto de referencia</label>
        <textarea id="observacionDireccion" class="form-control" name="observacionDireccion" 
                  rows="2" maxlength="200" placeholder="Ej: entrada por porter√≠a, conjunto, torre, casa color..." disabled></textarea>
      </div>

      <!-- Ciudad con autocompletado -->
      <div class="mb-3 position-relative">
        <label for="ciudadCliente" class="form-label fw-bold">Ciudad <span class="text-danger">*</span></label>
        <input type="text" id="ciudadCliente" class="form-control" name="ciudadCliente" 
               placeholder="Escribe tu ciudad" autocomplete="off" disabled required>
        <ul id="sugerenciasCiudades" class="dropdown-menu w-100 mt-0 z-3 d-none"></ul>
      </div>

      <!-- Correo electr√≥nico -->
      <div class="mb-3">
        <label for="emailCliente" class="form-label fw-bold">Correo electr√≥nico</label>
        <input type="email" class="form-control" id="emailCliente" name="emailCliente" disabled>
      </div>

      <!-- Bot√≥n Enviar -->
      <div class="text-center mt-4">
        <button id="btnEnviarPedido" class="btn btn-gradient px-4 py-2 rounded-pill fw-bold" disabled>
          <i class="bi bi-send"></i> ‚ú® Enviar pedido ‚ú®
        </button>
        <button type="button" class="btn btn-outline-dark ms-2" onclick="location.reload()">
          <i class="bi bi-arrow-clockwise"></i> Refrescar
        </button>
      </div>
    </form>
  </main>

  <!-- FOOTER -->
  <footer class="footer mt-4" id="footer-container">
    <div class="text-center py-4">
      <div class="spinner-border spinner-border-sm text-primary"></div>
      <p class="mt-1 small text-muted">Cargando informaci√≥n...</p>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- ‚úÖ VALIDACIONES B√ÅSICAS INLINE -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      console.log("üöÄ Formulario de registro cargado");
      
      // Validaci√≥n de tel√©fono
      const campoTelefono = document.getElementById("telefonoCliente");
      if (campoTelefono) {
        campoTelefono.addEventListener("input", function() {
          // Solo n√∫meros
          this.value = this.value.replace(/\D/g, "");
          
          // Validar formato
          if (this.value.length === 10 && !this.value.startsWith("3")) {
            this.classList.add("is-invalid");
            showToast("‚ö†Ô∏è El celular debe comenzar con 3", "warning");
          } else if (this.value.length === 10) {
            this.classList.remove("is-invalid");
            this.classList.add("is-valid");
          } else {
            this.classList.remove("is-invalid", "is-valid");
          }
        });
      }
      
      // Funci√≥n para toast (si no existe)
      if (!window.showToast) {
        window.showToast = function(mensaje, tipo = "info") {
          const toast = document.createElement("div");
          toast.className = `toast align-items-center text-bg-${tipo} border-0 position-fixed bottom-0 end-0 m-3`;
          toast.style.zIndex = "9999";
          toast.innerHTML = `
            <div class="d-flex">
              <div class="toast-body">${mensaje}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
          `;
          document.body.appendChild(toast);
          const bsToast = new bootstrap.Toast(toast);
          bsToast.show();
          setTimeout(() => toast.remove(), 3000);
        };
      }
    });
  </script>

  <!-- ‚úÖ SCRIPT DEL FORMULARIO -->
  <script src="modalformulario.js?v=20251116" defer></script>
  
  <!-- ‚úÖ SCRIPT PARA CARGAR HEADER/FOOTER -->
  <script>
    // Cargar header
    fetch("HEADER.HTML")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-container").innerHTML = html;
        
        // Remover men√∫ lateral duplicado si existe
        const menuDuplicado = document.querySelector('.offcanvas-start');
        if (menuDuplicado && menuDuplicado.id === 'menuLateral') {
          menuDuplicado.remove();
        }
      })
      .catch(err => console.error("‚ùå Error cargando header:", err));
    
    // Cargar footer
    fetch("FOOTER.HTML")
      .then(res => res.text())
      .then(html => {
        document.getElementById("footer-container").innerHTML = html;
      })
      .catch(err => console.error("‚ùå Error cargando footer:", err));
  </script>
</body>
</html>
