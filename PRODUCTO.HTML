<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detalle Producto | Anmago Store</title>
  <meta name="description" content="Descubre este producto exclusivo en Anmago Store. Calidad garantizada y los mejores precios.">
    <!-- Preconexiones optimizadas -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://ik.imagekit.io">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="preload" href="logo.jpg" as="image" type="image/jpeg">
  
  <!-- PWA y favicon -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="logo.jpg" type="image/x-icon" />

  <!-- Bootstrap e iconos -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

  <!-- CSS optimizado -->
  <link rel="stylesheet" href="ESTILO.CSS?v=20251207" />
</head>
<body class="bg-light">
  <!-- HEADER STICKY -->
  <div id="header-container" class="header-sticky"></div>

  <!-- BANNER PROMOCIONAL -->
  <div class="container-fluid banner-promocional py-2">
    <div class="container text-center">
      <small class="fw-bold">‚≠ê Los mejores precios ‚≠ê Calidad garantizada</small>
    </div>
  </div>

  <!-- BOT√ìN INSTALAR APP -->
  <div id="instalar-container" class="instalar-container d-none">
    <button id="boton-instalar" class="btn-instalar-app">
      <i class="bi bi-download"></i> Instalar App
    </button>
  </div>

  <!-- BOTONES EN LA MISMA L√çNEA - COMPACTO -->
  <div class="container mt-3">
    <div class="row align-items-center">
      <!-- Bot√≥n Volver atr√°s (izquierda) -->
      <div class="col text-start">
        <button id="btn-volver-atras" class="btn btn-outline-dark btn-sm">
          <i class="bi bi-arrow-left"></i> Volver
        </button>
      </div>

      <!-- Bot√≥n Ofertas Especiales (derecha) -->
      <div class="col text-end">
        <a href="PROMOS.HTML" class="btn btn-warning fw-bold px-3 py-2 rounded-pill">
          üéÅ Ofertas
        </a>
      </div>
    </div>
  </div>

  <!-- CONTENIDO PRINCIPAL - DETALLE PRODUCTO -->
  <main class="container mt-4">
    
    <!-- T√çTULO Y PRECIO PARA M√ìVIL (ARRIBA DE TODO) -->
    <div class="d-block d-md-none mb-4">
      <!-- Categor√≠as -->
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb" id="breadcrumb-producto-mobile">
          <li class="breadcrumb-item"><a href="INICIO.HTML">ATR√ÅS</a></li>
          <!-- Categor√≠as se cargan din√°micamente -->
        </ol>
      </nav>

      <!-- Nombre y precio -->
      <h1 id="nombre-producto-mobile" class="h3 fw-bold mb-2"></h1>
      <div class="d-flex align-items-center gap-3 mb-3">
        <span id="precio-actual-mobile" class="h4 fw-bold text-primary mb-0"></span>
        <span id="precio-original-mobile" class="text-muted h5 mb-0 text-decoration-line-through" style="display: none;"></span>
        <span id="descuento-mobile" class="badge badge-oferta fs-6" style="display: none;"></span>
      </div>
    </div>

    <div class="row">
      <!-- GALER√çA DE IM√ÅGENES CON ZOOM -->
      <div class="col-md-6 mb-4">
        <div class="sticky-top" style="top: 100px;">
          <!-- IMAGEN PRINCIPAL CON ZOOM MEJORADA -->
          <div class="position-relative mb-3">
            <img id="imagen-principal" src="" alt="Producto" 
                 class="card-img-ml shadow img-fluid"
                 style="cursor: zoom-in; max-height: 500px; width: 100%; object-fit: contain; transition: all 0.3s ease; border-radius: 12px;"
                 data-bs-toggle="modal" data-bs-target="#modalZoom">
            
            <!-- Indicador de zoom -->
            <div class="position-absolute top-0 end-0 m-3">
              <div class="bg-dark bg-opacity-75 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                <i class="bi bi-zoom-in text-white fs-6"></i>
              </div>
            </div>
            
            <!-- Texto ayuda -->
            <div class="position-absolute bottom-0 start-0 end-0 text-center mb-2 d-none d-md-block">
              <small class="badge bg-dark bg-opacity-75 text-white px-3 py-2">
                <i class="bi bi-mouse"></i> Clic para ampliar ‚Ä¢ 
                <i class="bi bi-arrows-fullscreen"></i> Doble clic para zoom m√°ximo
              </small>
            </div>
          </div>
          
          <!-- ALERTA PARA SELECCIONAR IMAGEN -->
          <div id="alerta-seleccion-imagen" class="alert alert-warning mt-3" style="display: none;">
            <i class="bi bi-exclamation-triangle"></i> 
            <strong>¬°Selecciona una imagen!</strong> Por favor elige la variante que deseas.
          </div>
          
          <div class="galeria-miniaturas" id="galeria-miniaturas">
            <!-- Miniaturas se cargan din√°micamente -->
          </div>

          <!-- Badges de estado -->
          <div class="mt-3" id="badges-producto">
            <!-- Badges se cargan din√°micamente -->
          </div>

          <!-- VIDEO DEL PRODUCTO EN DESKTOP (debajo de las im√°genes) -->
          <div id="video-producto-desktop" class="d-none d-md-block mt-4"></div>
        </div>
      </div>

      <!-- INFORMACI√ìN DEL PRODUCTO -->
      <div class="col-md-6">
        <div class="ps-md-4">
          <!-- T√çTULO Y PRECIO PARA DESKTOP (DENTRO DE LA COLUMNA) -->
          <div class="d-none d-md-block">
            <!-- Categor√≠as -->
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb" id="breadcrumb-producto-desktop">
                <li class="breadcrumb-item"><a href="INICIO.HTML">ATR√ÅS</a></li>
                <!-- Categor√≠as se cargan din√°micamente -->
              </ol>
            </nav>

            <!-- Nombre y precio -->
            <h1 id="nombre-producto-desktop" class="h3 fw-bold mb-2"></h1>
            <div class="d-flex align-items-center gap-3 mb-3">
              <span id="precio-actual-desktop" class="h4 fw-bold text-primary mb-0"></span>
              <span id="precio-original-desktop" class="text-muted h5 mb-0 text-decoration-line-through" style="display: none;"></span>
              <span id="descuento-desktop" class="badge badge-oferta fs-6" style="display: none;"></span>
            </div>
          </div>

          <!-- VIDEO DEL PRODUCTO EN M√ìVIL (antes de la descripci√≥n) -->
          <div id="video-producto-mobile" class="d-block d-md-none mb-4"></div>

          <!-- VARIANTE ACTUAL (se muestra cuando se selecciona imagen) -->
          <div class="mb-3" id="variante-actual-container" style="display: none;">
            <h5 class="fw-bold mb-2">üé® Variante seleccionada</h5>
            <div class="alert alert-info py-2">
              <span id="variante-actual-texto"></span>
            </div>
          </div>
               
          <!-- SELECTOR DE VARIABLES (COLORES/MATERIALES) -->
          <div class="mb-4" id="seccion-variables">
            <!-- Selector de variables se carga din√°micamente -->
          </div>

          <!-- SELECTOR DE TALLAS -->
          <div class="mb-4" id="seccion-tallas">
            <!-- Selector de tallas se carga din√°micamente -->
          </div>

          <!-- Cantidad -->
          <div class="mb-4">
            <h5 class="fw-bold mb-3">üî¢ Cantidad</h5>
            <div class="d-flex align-items-center gap-3">
              <button class="btn btn-outline-secondary" onclick="app.producto.cambiarCantidad(-1)">-</button>
              <input type="number" id="input-cantidad" class="form-control text-center" value="1" min="1" max="10" style="width: 80px;">
              <button class="btn btn-outline-secondary" onclick="app.producto.cambiarCantidad(1)">+</button>
            </div>
          </div>

          <!-- Botones de acci√≥n -->
          <div class="d-grid gap-2 d-md-flex mb-4">
            <button id="btn-agregar-carrito" class="btn btn-agregar-carrito btn-lg flex-fw-bold" onclick="app.producto.agregarAlCarrito()" disabled>
              <i class="bi bi-cart-plus"></i> Agregar al carrito
            </button>
            <button class="btn btn-gradient btn-lg" onclick="app.producto.comprarAhora()" disabled>
              <i class="bi bi-lightning"></i> Comprar ahora
            </button>
          </div>

          <!-- Descripci√≥n -->
          <div class="mb-4">
            <h5 class="fw-bold mb-2">üìã Descripci√≥n</h5>
            <p id="descripcion-producto" class="text-muted"></p>
          </div>

          <!-- SERVICIOS (REEMPLAZA ENV√çO GRATIS) -->
          <div class="card border-0 bg-light">
            <div class="card-body">
              <div class="row text-center">
                <div class="col-4">
                  <i class="bi bi-shield-check text-primary fs-4"></i>
                  <div class="small mt-1">Calidad</div>
                </div>
                <div class="col-4">
                  <i class="bi bi-star text-primary fs-4"></i>
                  <div class="small mt-1">Garant√≠a</div>
                </div>
                <div class="col-4">
                  <i class="bi bi-percent text-primary fs-4"></i>
                  <div class="small mt-1">PROMOS</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PRODUCTOS RELACIONADOS -->
    <section class="mt-5 pt-4 border-top">
      <h3 class="h4 fw-bold mb-4">üõçÔ∏è Productos relacionados</h3>
      <div id="productos-relacionados" class="grid-productos-ml">
        <!-- Productos relacionados se cargan din√°micamente -->
        <div class="card-producto-ml skeleton" style="height: 280px;"></div>
        <div class="card-producto-ml skeleton" style="height: 280px;"></div>
        <div class="card-producto-ml skeleton" style="height: 280px;"></div>
        <div class="card-producto-ml skeleton" style="height: 280px;"></div>
      </div>
    </section>
  </main>

  <!-- CARRITO OFFCANVAS -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasCarrito">
    <div class="offcanvas-header border-bottom">
      <h4 class="offcanvas-title fw-bold">üõí Tu Carrito</h4>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body" id="carrito-contenido">
      <div class="text-center text-muted py-4">
        <i class="bi bi-bag-x fs-1"></i>
        <p class="mt-2">Tu carrito est√° vac√≠o</p>
      </div>
    </div>
    <div class="offcanvas-footer p-3 border-top">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="fw-bold">Subtotal:</span>
        <span id="subtotal" class="fw-bold fs-5 text-primary">$0</span>
      </div>
      <button class="btn btn-gradient px-4 py-2 rounded-pill fw-bold" onclick="app.carrito.abrirFormularioPedido()">
        ‚ú®Continuar compra‚ú®
      </button>
    </div>
  </div>

  <!-- MODAL DE ZOOM MEJORADO -->
  <div class="modal fade" id="modalZoom" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content">
        <div class="modal-header border-0">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body p-0">
          <div class="row g-0">
            <div class="col-md-9">
              <div class="position-relative" style="min-height: 500px;">
                <img id="modal-zoom-imagen" src="" alt="" class="img-fluid w-100 h-100" style="object-fit: contain;">
                <div class="position-absolute top-50 start-0 translate-middle-y">
                  <button class="btn btn-dark rounded-circle p-2 ms-2" onclick="app.zoom.navegar(-1)" id="btn-prev">
                    <i class="bi bi-chevron-left"></i>
                  </button>
                </div>
                <div class="position-absolute top-50 end-0 translate-middle-y">
                  <button class="btn btn-dark rounded-circle p-2 me-2" onclick="app.zoom.navegar(1)" id="btn-next">
                    <i class="bi bi-chevron-right"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="col-md-3 bg-light p-3">
              <div class="mb-3">
                <h6 class="fw-bold">Miniaturas</h6>
                <div class="d-flex flex-wrap gap-2" id="modal-miniaturas"></div>
              </div>
              <div class="mb-3">
                <h6 class="fw-bold">Informaci√≥n</h6>
                <p id="modal-variante-info" class="small mb-0"></p>
              </div>
              <button class="btn btn-primary w-100" onclick="app.zoom.seleccionarActual()">
                <i class="bi bi-check-circle"></i> Seleccionar esta variante
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BOT√ìN CARRITO FLOTANTE -->
  <a href="#" class="btn-carrito-flotante d-none d-md-flex" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCarrito">
    <i class="bi bi-bag-heart fs-5"></i>
    <span id="contador-carrito" class="contador-carrito">0</span>
  </a>

  <!-- FOOTER -->
  <div id="footer-container" class="mt-5"></div>

  <!-- BARRA INFERIOR MOBILE -->
  <nav class="navbar fixed-bottom bg-white border-top d-md-none py-2">
    <div class="container-fluid">
      <div class="d-flex justify-content-around w-100">
        <a href="INICIO.HTML" class="text-center text-decoration-none text-primary">
          <i class="bi bi-house-fill fs-5"></i>
          <div class="small">Inicio</div>
        </a>
        <a href="PROMOS.HTML" class="text-center text-decoration-none text-dark">
          <i class="bi bi-percent fs-5"></i>
          <div class="small">Ofertas</div>
        </a>
        <a href="#" class="text-center text-decoration-none position-relative"
           data-bs-toggle="offcanvas" data-bs-target="#offcanvasCarrito">
          <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" 
               style="width: 50px; height: 50px; margin-top: -8px;">
            <i class="bi bi-bag-heart fs-5 text-white"></i>
          </div>
          <span id="contador-carrito-mobile" class="position-absolute top-0 start-100 translate-middle badge bg-danger rounded-pill" style="font-size: 0.6rem;">0</span>
          <div class="small mt-1">Carrito</div>
        </a>
        <a href="https://wa.me/573006498710?text=¬°Hola!%20Me%20interesan%20sus%20productos%20de%20Anmago%20Store" 
           class="text-center text-decoration-none text-success"
           target="_blank" rel="noopener noreferrer">
          <i class="bi bi-whatsapp fs-5"></i>
          <div class="small">Chat</div>
        </a>
        <a href="modalformulario.html" class="text-center text-decoration-none text-dark">
          <i class="bi bi-person fs-5"></i>
          <div class="small">Cuenta</div>
        </a>
      </div>
    </div>
  </nav>

  <!-- SCRIPTS EXTERNOS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- SISTEMA MODULAR MEJORADO -->
  <script>
    // ========== APLICACI√ìN PRINCIPAL ==========
    const app = (() => {
      // Variables de estado
      const state = {
        producto: null,
        varianteSeleccionada: '',
        variableSeleccionada: '',
        tallaSeleccionada: '',
        imagenSeleccionada: '',
        cantidad: 1,
        promociones: [],
        imagenes: [],
        nombresVariantes: [],
        zoomIndex: 0
      };

      // ========== CACHE MANAGER ==========
      const cache = {
        CACHE_KEYS: {
          CATALOGO: 'anmago_catalogo_cache',
          PROMOCIONES: 'anmago_promociones_cache',
          NAVEGACION: 'navegacionAnmago'
        },

        async getCatalogo(forceRefresh = false) {
          if (!forceRefresh) {
            const cached = localStorage.getItem(this.CACHE_KEYS.CATALOGO);
            if (cached) {
              const { data, timestamp } = JSON.parse(cached);
              const ahora = Date.now();
              // Cache v√°lido por 1 hora
              if (ahora - timestamp < 3600000) {
                console.log('üì¶ Cat√°logo cargado desde cache');
                return data;
              }
            }
          }

          try {
            const url = "https://raw.githubusercontent.com/anmagoS/ANMAGOPWA/main/catalogo.json?t=" + Date.now();
            const respuesta = await fetch(url);
            
            if (!respuesta.ok) throw new Error(`HTTP ${respuesta.status}`);
            
            const data = await respuesta.json();
            
            // Guardar en cache
            localStorage.setItem(this.CACHE_KEYS.CATALOGO, JSON.stringify({
              data,
              timestamp: Date.now()
            }));
            
            console.log('üì¶ Cat√°logo cargado desde red y cacheado');
            return data;
          } catch (error) {
            console.error('‚ùå Error cargando cat√°logo:', error);
            throw error;
          }
        },

        clearCache() {
          Object.values(this.CACHE_KEYS).forEach(key => {
            localStorage.removeItem(key);
          });
          console.log('üóëÔ∏è Cache limpiado');
        }
      };

      // ========== NAVEGACI√ìN ==========
      const navegacion = {
        guardarEstado() {
          const urlParams = new URLSearchParams(window.location.search);
          const origen = urlParams.get('origen');
          const tipo = urlParams.get('tipo');
          const subtipo = urlParams.get('subtipo');
          const categoria = urlParams.get('categoria');
          
          if (origen === 'tienda' && tipo && subtipo && categoria) {
            const estado = {
              vistaAnterior: 'productos',
              tipo,
              subtipo,
              categoria,
              timestamp: Date.now()
            };
            
            localStorage.setItem(cache.CACHE_KEYS.NAVEGACION, JSON.stringify(estado));
            console.log('üíæ Estado guardado:', estado);
          }
        },

        volverAtras() {
          const estadoGuardado = localStorage.getItem(cache.CACHE_KEYS.NAVEGACION);
          
          if (estadoGuardado) {
            try {
              const estado = JSON.parse(estadoGuardado);
              const tiempoTranscurrido = Date.now() - estado.timestamp;
              
              if (tiempoTranscurrido < 1800000) { // 30 minutos
                let urlRetorno = 'INICIO.HTML';
                
                switch (estado.vistaAnterior) {
                  case 'productos':
                    urlRetorno = `INICIO.HTML?vista=productos&tipo=${encodeURIComponent(estado.tipo)}&subtipo=${encodeURIComponent(estado.subtipo)}&categoria=${encodeURIComponent(estado.categoria)}`;
                    break;
                  case 'categorias':
                    urlRetorno = `INICIO.HTML?vista=categorias&tipo=${encodeURIComponent(estado.tipo)}&subtipo=${encodeURIComponent(estado.subtipo)}`;
                    break;
                  case 'subtipos':
                    urlRetorno = `INICIO.HTML?vista=subtipos&tipo=${encodeURIComponent(estado.tipo)}`;
                    break;
                }
                
                window.location.href = urlRetorno;
                return;
              }
            } catch (error) {
              console.error('‚ùå Error procesando estado:', error);
            }
          }
          
          window.location.href = 'INICIO.HTML';
        }
      };

      // ========== PROMOCIONES ==========
      const promociones = {
        vieneDePromociones() {
          const urlParams = new URLSearchParams(window.location.search);
          const origen = urlParams.get('origen');
          return origen === 'promos' || origen === 'home' || window.location.pathname.includes('PROMOS');
        },

        obtenerIndicePromocional(totalPromos = 0) {
          const hora = new Date().getHours();
          const bloque = Math.floor(hora / 6);
          const indice = bloque * 8;
          
          console.log('üìÖ √çndice promocional:', { hora, bloque: bloque + 1, indice });
          return totalPromos > 0 ? indice % totalPromos : indice;
        },

        estaEnPromocionActual(productoId) {
          if (!Array.isArray(state.promociones) || state.promociones.length === 0) {
            return false;
          }
          
          const indiceActual = this.obtenerIndicePromocional(state.promociones.length);
          const bloqueActual = state.promociones.slice(indiceActual, indiceActual + 8);
          
          const estaEnPromo = bloqueActual.some(promo => promo.id === productoId);
          
          console.log('üî• Verificaci√≥n promoci√≥n:', {
            productoId,
            estaEnPromo,
            bloqueActual: bloqueActual.map(p => ({id: p.id, nombre: p.producto})),
            indiceActual
          });
          
          return estaEnPromo;
        }
      };

      // ========== PRODUCTO MANAGER ==========
      const productoManager = {
        async inicializar() {
          console.log('üöÄ Inicializando producto...');
          
          navegacion.guardarEstado();
          await this.cargarHeaderFooter();
          this.configurarEventos();
          
          setTimeout(async () => {
            await this.cargarProducto();
          }, 100);
          
          carritoManager.actualizarContadores();
        },

        async cargarHeaderFooter() {
          try {
            const [header, footer] = await Promise.all([
              fetch("HEADER.HTML").then(r => r.text()),
              fetch("footer.html").then(r => r.text())
            ]);
            
            document.getElementById("header-container").innerHTML = header;
            document.getElementById("footer-container").innerHTML = footer;
            console.log('‚úÖ Header y footer cargados');
          } catch (error) {
            console.error("‚ùå Error cargando recursos:", error);
          }
        },

        configurarEventos() {
          // Bot√≥n volver
          document.getElementById('btn-volver-atras').addEventListener('click', navegacion.volverAtras);
          
          // Input cantidad
          const inputCantidad = document.getElementById('input-cantidad');
          inputCantidad.addEventListener('change', (e) => {
            state.cantidad = Math.max(1, Math.min(10, parseInt(e.target.value) || 1));
            e.target.value = state.cantidad;
          });
          
          // Modal zoom
          const modalZoom = document.getElementById('modalZoom');
          if (modalZoom) {
            modalZoom.addEventListener('show.bs.modal', (e) => {
              zoomManager.inicializarModal();
            });
          }
        },

        obtenerIdProducto() {
          const urlParams = new URLSearchParams(window.location.search);
          return urlParams.get('id');
        },

        async cargarProducto() {
          const productoId = this.obtenerIdProducto();
          
          if (!productoId) {
            this.mostrarError('No se especific√≥ ID de producto');
            return;
          }

          try {
            const productos = await cache.getCatalogo();
            
            // Filtrar promociones
            state.promociones = productos.filter(p => {
              const promo = typeof p.promo === "string" ? p.promo.toLowerCase().trim() : p.promo;
              return promo === true || promo === "true" || promo === "s√≠" || promo === "activo" || promo === "si";
            });
            
            // Buscar producto
            state.producto = productos.find(p => p.id === productoId);
            
            if (!state.producto) {
              throw new Error(`Producto ${productoId} no encontrado`);
            }

            // Inicializar im√°genes
            this.inicializarImagenes();
            
            // Renderizar
            this.renderizarProducto();
            
            // Cargar relacionados
            this.cargarProductosRelacionados(productos);

          } catch (error) {
            console.error('üí• Error:', error);
            this.mostrarError(`Error: ${error.message}`);
          }
        },

        inicializarImagenes() {
          if (state.producto.url && state.producto.url.includes("[]")) {
            state.imagenes = state.producto.url.split("[]").map(u => u.trim()).filter(Boolean);
            state.nombresVariantes = state.imagenes.map((_, i) => `Variante ${i + 1}`);
          } else {
            state.imagenes = [state.producto.imagen];
            state.nombresVariantes = ['Variante 1'];
          }
          
          state.imagenSeleccionada = state.imagenes[0];
          state.varianteSeleccionada = state.nombresVariantes[0];
        },

        calcularPrecio() {
          const precioBase = state.producto.precio || 0;
          const estaEnPromo = promociones.vieneDePromociones() || 
                              promociones.estaEnPromocionActual(state.producto.id);
          
          if (estaEnPromo) {
            return Math.round(precioBase * 0.9);
          }
          
          return precioBase;
        },

        renderizarProducto() {
          const producto = state.producto;
          const precioActual = this.calcularPrecio();
          const estaEnPromo = promociones.vieneDePromociones() || 
                              promociones.estaEnPromocionActual(producto.id);
          
          // Nombres
          document.getElementById('nombre-producto-mobile').textContent = producto.producto;
          document.getElementById('nombre-producto-desktop').textContent = producto.producto;
          document.getElementById('descripcion-producto').textContent = 
            producto.descripcion || 'Producto de alta calidad disponible en Anmago Store.';
          
          // Precios
          this.renderizarPrecios(precioActual, estaEnPromo);
          
          // Galer√≠a
          this.renderizarGaleria();
          
          // Breadcrumb
          this.renderizarBreadcrumb();
          
          // Selectores
          this.renderizarSelectores();
          
          // Badges
          this.renderizarBadges(estaEnPromo);
          
          // Video
          this.renderizarVideo();
          
          this.verificarEstadoBoton();
        },

        renderizarPrecios(precioActual, estaEnPromo) {
          const precioBase = state.producto.precio || 0;
          
          // M√≥vil
          document.getElementById('precio-actual-mobile').textContent = `$${precioActual.toLocaleString('es-CO')}`;
          
          if (estaEnPromo && precioBase > precioActual) {
            document.getElementById('precio-original-mobile').textContent = `$${precioBase.toLocaleString('es-CO')}`;
            document.getElementById('descuento-mobile').textContent = `-${Math.round((1 - precioActual / precioBase) * 100)}%`;
            document.getElementById('precio-original-mobile').style.display = 'inline';
            document.getElementById('descuento-mobile').style.display = 'inline';
          }
          
          // Desktop
          document.getElementById('precio-actual-desktop').textContent = `$${precioActual.toLocaleString('es-CO')}`;
          
          if (estaEnPromo && precioBase > precioActual) {
            document.getElementById('precio-original-desktop').textContent = `$${precioBase.toLocaleString('es-CO')}`;
            document.getElementById('descuento-desktop').textContent = `-${Math.round((1 - precioActual / precioBase) * 100)}%`;
            document.getElementById('precio-original-desktop').style.display = 'inline';
            document.getElementById('descuento-desktop').style.display = 'inline';
          }
        },

        renderizarGaleria() {
          const imagenPrincipal = document.getElementById('imagen-principal');
          const galeria = document.getElementById('galeria-miniaturas');
          
          if (state.imagenes.length === 0) {
            imagenPrincipal.src = 'https://ik.imagekit.io/mbsk9dati/placeholder-producto.jpg';
            return;
          }
          
          imagenPrincipal.src = state.imagenes[0];
          imagenPrincipal.alt = state.producto.producto;
          
          // Mostrar variante actual
          this.mostrarVarianteActual(state.nombresVariantes[0]);
          
          // Miniaturas
          if (state.imagenes.length > 1) {
            galeria.innerHTML = state.imagenes.map((img, index) => {
              const nombre = state.nombresVariantes[index];
              return `
                <img src="${img}" 
                     alt="${state.producto.producto} - ${nombre}" 
                     class="miniatura ${index === 0 ? 'active' : ''}"
                     data-index="${index}"
                     style="width: 80px; height: 80px; object-fit: cover; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; margin: 5px; transition: border-color 0.3s;">
              `;
            }).join('');
            
            // Eventos para miniaturas
            galeria.querySelectorAll('.miniatura').forEach(img => {
              img.addEventListener('click', (e) => {
                const index = parseInt(e.target.dataset.index);
                this.seleccionarImagen(index);
              });
              
              img.addEventListener('mouseover', (e) => {
                if (!e.target.classList.contains('active')) {
                  e.target.style.borderColor = '#007bff';
                }
              });
              
              img.addEventListener('mouseout', (e) => {
                if (!e.target.classList.contains('active')) {
                  e.target.style.borderColor = '#ddd';
                }
              });
            });
          }
        },

        seleccionarImagen(index) {
          if (index < 0 || index >= state.imagenes.length) return;
          
          // Actualizar imagen principal
          document.getElementById('imagen-principal').src = state.imagenes[index];
          
          // Actualizar estado
          state.imagenSeleccionada = state.imagenes[index];
          state.varianteSeleccionada = state.nombresVariantes[index];
          state.zoomIndex = index;
          
          // Mostrar variante
          this.mostrarVarianteActual(state.nombresVariantes[index]);
          
          // Actualizar miniaturas
          document.querySelectorAll('.miniatura').forEach((img, i) => {
            img.classList.toggle('active', i === index);
            img.style.borderColor = i === index ? '#007bff' : '#ddd';
          });
          
          this.verificarEstadoBoton();
        },

        mostrarVarianteActual(nombre) {
          const container = document.getElementById('variante-actual-container');
          const texto = document.getElementById('variante-actual-texto');
          
          texto.textContent = nombre;
          container.style.display = 'block';
          document.getElementById('alerta-seleccion-imagen').style.display = 'none';
        },

        renderizarSelectores() {
          this.renderizarVariables();
          this.renderizarTallas();
        },

        renderizarVariables() {
          const contenedor = document.getElementById('seccion-variables');
          const producto = state.producto;
          
          const tieneVariables = producto.variables && 
                                producto.variables.trim() !== "" && 
                                producto.variables !== "N/A" &&
                                !['√∫nica', 'unica'].includes(producto.variables.toLowerCase());
        
          if (tieneVariables) {
            const variables = producto.variables.split(",").map(v => v.trim()).filter(v => v);
            
            const select = document.createElement('select');
            select.className = 'form-select selector-variable';
            select.style.maxWidth = '250px';
            select.innerHTML = `
              <option value="">-- Elige una opci√≥n --</option>
              ${variables.map(v => `<option value="${v}">${v}</option>`).join('')}
            `;
            
            select.addEventListener('change', (e) => {
              state.variableSeleccionada = e.target.value;
              this.verificarEstadoBoton();
            });
            
            contenedor.innerHTML = `
              <h5 class="fw-bold mb-3">üé® Selecciona color/material</h5>
            `;
            contenedor.appendChild(select);
            contenedor.innerHTML += `
              <div class="form-text mt-2">üí° Selecciona tu color o material preferido</div>
            `;
          } else {
            contenedor.innerHTML = '';
          }
        },

        renderizarTallas() {
          const contenedor = document.getElementById('seccion-tallas');
          const producto = state.producto;
          
          const necesitaTallas = producto.tallas && 
                               producto.tallas.trim() !== "" && 
                               producto.tallas !== "N/A" && 
                               !['√∫nica', 'unica'].includes(producto.tallas.toLowerCase());
        
          if (necesitaTallas) {
            const tallas = producto.tallas.split(",").map(t => t.trim()).filter(t => t);
            
            const select = document.createElement('select');
            select.className = 'form-select selector-talla';
            select.style.maxWidth = '250px';
            select.innerHTML = `
              <option value="">-- Elige una talla --</option>
              ${tallas.map(t => `<option value="${t}">${t}</option>`).join('')}
            `;
            
            select.addEventListener('change', (e) => {
              state.tallaSeleccionada = e.target.value;
              this.verificarEstadoBoton();
            });
            
            contenedor.innerHTML = `
              <h5 class="fw-bold mb-3">üìè Selecciona tu talla</h5>
            `;
            contenedor.appendChild(select);
            contenedor.innerHTML += `
              <div class="form-text mt-2">üí° Aseg√∫rate de seleccionar tu talla correcta</div>
            `;
          } else {
            contenedor.innerHTML = '';
          }
        },

        verificarEstadoBoton() {
          const btnAgregar = document.getElementById('btn-agregar-carrito');
          const btnComprar = document.querySelector('.btn-gradient');
          
          if (!btnAgregar) return;
          
          const producto = state.producto;
          const necesitaVariables = producto.variables && 
                                  producto.variables.trim() !== "" && 
                                  producto.variables !== "N/A" &&
                                  !['√∫nica', 'unica'].includes(producto.variables.toLowerCase());
          
          const necesitaTallas = producto.tallas && 
                               producto.tallas.trim() !== "" && 
                               producto.tallas !== "N/A" && 
                               !['√∫nica', 'unica'].includes(producto.tallas.toLowerCase());
          
          let puedeAgregar = state.varianteSeleccionada;
          
          if (necesitaVariables) {
            puedeAgregar = puedeAgregar && state.variableSeleccionada;
          }
          
          if (necesitaTallas) {
            puedeAgregar = puedeAgregar && state.tallaSeleccionada;
          }
          
          btnAgregar.disabled = !puedeAgregar;
          if (btnComprar) btnComprar.disabled = !puedeAgregar;
          
          // Actualizar texto del bot√≥n
          if (!state.varianteSeleccionada) {
            btnAgregar.innerHTML = '<i class="bi bi-image"></i> Selecciona una imagen';
          } else if (necesitaVariables && !state.variableSeleccionada) {
            btnAgregar.innerHTML = '<i class="bi bi-palette"></i> Selecciona color/material';
          } else if (necesitaTallas && !state.tallaSeleccionada) {
            btnAgregar.innerHTML = '<i class="bi bi-rulers"></i> Selecciona talla';
          } else {
            btnAgregar.innerHTML = '<i class="bi bi-cart-plus"></i> Agregar al carrito';
          }
        },

        cambiarCantidad(delta) {
          state.cantidad = parseInt(document.getElementById('input-cantidad').value) + delta;
          state.cantidad = Math.max(1, Math.min(10, state.cantidad));
          document.getElementById('input-cantidad').value = state.cantidad;
        },

        async agregarAlCarrito() {
          if (!this.validarSeleccion()) return false;
          
          const precioFinal = this.calcularPrecio();
          const estaEnPromo = promociones.vieneDePromociones() || 
                              promociones.estaEnPromocionActual(state.producto.id);
          
          const productoCarrito = {
            id: `${state.producto.id}-${state.varianteSeleccionada}-${state.variableSeleccionada || 'unica'}-${state.tallaSeleccionada || 'unica'}`.replace(/\s+/g, '_'),
            nombre: `${state.producto.producto} - ${state.varianteSeleccionada}` +
                    (state.variableSeleccionada ? ` - ${state.variableSeleccionada}` : '') +
                    (state.tallaSeleccionada ? ` - Talla ${state.tallaSeleccionada}` : ''),
            precio: precioFinal,
            imagen: state.imagenSeleccionada,
            variante: state.varianteSeleccionada,
            variable: state.variableSeleccionada || '√önica',
            talla: state.tallaSeleccionada || '√önica',
            cantidad: state.cantidad,
            enPromocion: estaEnPromo,
            precioOriginal: state.producto.precio || 0
          };
          
          try {
            const resultado = await carritoManager.agregarProducto(productoCarrito);
            
            if (resultado) {
              this.mostrarConfirmacionAgregado();
              return true;
            }
          } catch (error) {
            console.error('‚ùå Error:', error);
            this.mostrarAlerta('Error al agregar al carrito', 'danger');
          }
          
          return false;
        },

        validarSeleccion() {
          if (!state.varianteSeleccionada) {
            this.mostrarAlerta('Por favor selecciona una imagen/variante', 'warning');
            return false;
          }
          
          const producto = state.producto;
          const necesitaVariables = producto.variables && 
                                  producto.variables.trim() !== "" && 
                                  producto.variables !== "N/A" &&
                                  !['√∫nica', 'unica'].includes(producto.variables.toLowerCase());
          
          const necesitaTallas = producto.tallas && 
                               producto.tallas.trim() !== "" && 
                               producto.tallas !== "N/A" && 
                               !['√∫nica', 'unica'].includes(producto.tallas.toLowerCase());
          
          if (necesitaVariables && !state.variableSeleccionada) {
            this.mostrarAlerta('Por favor selecciona un color/material', 'warning');
            return false;
          }
          
          if (necesitaTallas && !state.tallaSeleccionada) {
            this.mostrarAlerta('Por favor selecciona una talla', 'warning');
            return false;
          }
          
          return true;
        },

        comprarAhora() {
          if (this.agregarAlCarrito()) {
            setTimeout(() => {
              carritoManager.abrirFormularioPedido();
            }, 500);
          }
        },

        mostrarConfirmacionAgregado() {
          const btn = document.getElementById('btn-agregar-carrito');
          const originalText = btn.innerHTML;
          
          btn.innerHTML = '<i class="bi bi-check2"></i> ¬°Agregado!';
          btn.classList.remove('btn-agregar-carrito');
          btn.classList.add('btn-success');
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-agregar-carrito');
          }, 2000);
        },

        renderizarBreadcrumb() {
          const breadcrumbMobile = document.getElementById('breadcrumb-producto-mobile');
          const breadcrumbDesktop = document.getElementById('breadcrumb-producto-desktop');
          
          let categorias = [];
          const producto = state.producto;
          
          if (producto.tipo) categorias.push(producto.tipo);
          if (producto.categoria) categorias.push(producto.categoria);
          if (producto.subcategoria) categorias.push(producto.subcategoria);
          
          const breadcrumbItems = categorias.map(cat => 
            `<li class="breadcrumb-item"><a href="INICIO.HTML?categoria=${encodeURIComponent(cat)}">${cat}</a></li>`
          ).join('');
          
          const breadcrumbFinal = breadcrumbItems + 
            `<li class="breadcrumb-item active" aria-current="page">${producto.producto}</li>`;
          
          if (breadcrumbMobile) {
            breadcrumbMobile.innerHTML = breadcrumbMobile.firstElementChild.outerHTML + breadcrumbFinal;
          }
          if (breadcrumbDesktop) {
            breadcrumbDesktop.innerHTML = breadcrumbDesktop.firstElementChild.outerHTML + breadcrumbFinal;
          }
        },

        renderizarBadges(estaEnPromo) {
          const contenedor = document.getElementById('badges-producto');
          const producto = state.producto;
          const badges = [];
          
          if (estaEnPromo) {
            badges.push('<span class="badge bg-danger me-2">üî• Oferta Activa</span>');
          }
          
          if (producto.nuevo) {
            badges.push('<span class="badge bg-success me-2">üÜï Nuevo</span>');
          }
          
          if (producto.stock <= 5 && producto.stock > 0) {
            badges.push('<span class="badge bg-warning me-2">‚ö†Ô∏è √öltimas unidades</span>');
          }
          
          contenedor.innerHTML = badges.join('');
        },

        renderizarVideo() {
          const contenedorDesktop = document.getElementById('video-producto-desktop');
          const contenedorMobile = document.getElementById('video-producto-mobile');
          const producto = state.producto;
          
          if (!producto.video_url) {
            contenedorDesktop.style.display = 'none';
            contenedorMobile.style.display = 'none';
            return;
          }
          
          const videoUrlEmbed = this.convertirUrlYouTube(producto.video_url);
          
          const videoHTML = `
            <div class="mb-4">
              <h5 class="fw-bold mb-3">üé• Video del producto</h5>
              <div class="ratio ratio-16x9">
                <iframe 
                  src="${videoUrlEmbed}" 
                  title="Video del producto: ${producto.producto}"
                  class="rounded shadow"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen
                  loading="lazy">
                </iframe>
              </div>
              <div class="text-center mt-2">
                <small class="text-muted">
                  <i class="bi bi-play-circle"></i> Haz clic para ver el video del producto
                </small>
              </div>
            </div>
          `;
          
          contenedorDesktop.innerHTML = videoHTML;
          contenedorMobile.innerHTML = videoHTML;
        },

        convertirUrlYouTube(url) {
          if (url.includes('youtube.com/embed')) return url;
          
          let videoId = '';
          
          if (url.includes('youtube.com/watch?v=')) {
            videoId = url.split('v=')[1]?.split('&')[0];
          } else if (url.includes('youtu.be/')) {
            videoId = url.split('youtu.be/')[1]?.split('?')[0];
          } else if (url.includes('youtube.com/shorts/')) {
            videoId = url.split('shorts/')[1]?.split('?')[0];
          }
          
          return videoId ? `https://www.youtube.com/embed/${videoId}` : url;
        },

        async cargarProductosRelacionados(productos) {
          const relacionados = productos
            .filter(p => p.id !== state.producto.id && 
                (p.tipo === state.producto.tipo || 
                 p.categoria === state.producto.categoria))
            .slice(0, 4);
          
          const contenedor = document.getElementById('productos-relacionados');
          
          if (relacionados.length === 0) {
            contenedor.innerHTML = '<p class="text-muted text-center py-4">No hay productos relacionados</p>';
            return;
          }
          
          contenedor.innerHTML = relacionados.map(producto => {
            const precioBase = producto.precio || 0;
            const precioMostrar = this.calcularPrecio();
            const estaEnPromo = promociones.vieneDePromociones() || 
                                promociones.estaEnPromocionActual(producto.id);
            
            return `
            <div class="card-producto-ml">
              <a href="PRODUCTO.HTML?id=${producto.id}" class="text-decoration-none">
                <img src="${producto.imagen}" alt="${producto.producto}" 
                     class="card-img-ml imagen-completa" loading="lazy">
                <div class="card-body-ml">
                  <h3 class="nombre-producto-ml small line-clamp-2">${producto.producto}</h3>
                  <div class="d-flex align-items-center gap-2">
                    <p class="precio-ml fw-bold text-primary mb-0">$${precioMostrar.toLocaleString('es-CO')}</p>
                    ${estaEnPromo && precioBase > precioMostrar ? 
                      `<span class="text-muted small text-decoration-line-through">$${precioBase.toLocaleString('es-CO')}</span>
                       <span class="badge bg-danger small">-${Math.round((1 - precioMostrar/precioBase) * 100)}%</span>` 
                      : ''}
                  </div>
                  <span class="btn btn-outline-primary btn-sm mt-2">Ver detalle</span>
                </div>
              </a>
            </div>
            `;
          }).join('');
        },

        mostrarError(mensaje) {
          const main = document.querySelector('main');
          main.innerHTML = `
            <div class="container py-5">
              <div class="row justify-content-center">
                <div class="col-md-6 text-center">
                  <i class="bi bi-emoji-frown fs-1 text-muted mb-4"></i>
                  <h3 class="h4 text-muted mb-3">${mensaje}</h3>
                  <div class="d-grid gap-2 d-md-flex justify-content-center">
                    <button class="btn btn-primary" onclick="location.reload()">
                      <i class="bi bi-arrow-clockwise"></i> Reintentar
                    </button>
                    <a href="INICIO.HTML" class="btn btn-outline-primary">
                      <i class="bi bi-house"></i> Volver al inicio
                    </a>
                  </div>
                </div>
              </div>
            </div>
          `;
        },

        mostrarAlerta(mensaje, tipo = 'warning') {
          const alerta = document.createElement('div');
          alerta.className = `alert alert-${tipo} alert-dismissible fade show position-fixed`;
          alerta.style.cssText = `
            top: 20px; 
            right: 20px; 
            z-index: 9999; 
            min-width: 300px; 
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          `;
          
          const iconClass = {
            success: 'bi-check-circle',
            danger: 'bi-exclamation-triangle',
            warning: 'bi-info-circle'
          }[tipo] || 'bi-info-circle';
          
          alerta.innerHTML = `
            <div class="d-flex align-items-center">
              <i class="bi ${iconClass} me-2 fs-5"></i>
              <div class="flex-grow-1">${mensaje}</div>
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          `;
          
          document.body.appendChild(alerta);
          
          setTimeout(() => {
            if (alerta.parentNode) alerta.remove();
          }, 4000);
        }
      };

      // ========== ZOOM MANAGER ==========
      const zoomManager = {
        inicializarModal() {
          const modalImagen = document.getElementById('modal-zoom-imagen');
          const miniaturasContainer = document.getElementById('modal-miniaturas');
          
          if (!modalImagen || !miniaturasContainer) return;
          
          modalImagen.src = state.imagenes[state.zoomIndex];
          modalImagen.alt = `${state.producto.producto} - ${state.nombresVariantes[state.zoomIndex]}`;
          
          document.getElementById('modal-variante-info').textContent = 
            state.nombresVariantes[state.zoomIndex];
          
          // Miniaturas
          miniaturasContainer.innerHTML = state.imagenes.map((img, index) => `
            <img src="${img}" 
                 alt="Variante ${index + 1}"
                 class="img-thumbnail ${index === state.zoomIndex ? 'border-primary' : ''}"
                 style="width: 60px; height: 60px; object-fit: cover; cursor: pointer;"
                 onclick="app.zoom.seleccionar(${index})">
          `).join('');
          
          // Actualizar botones de navegaci√≥n
          this.actualizarBotonesNavegacion();
        },

        navegar(direccion) {
          const nuevoIndex = state.zoomIndex + direccion;
          
          if (nuevoIndex >= 0 && nuevoIndex < state.imagenes.length) {
            state.zoomIndex = nuevoIndex;
            this.actualizarModal();
          }
        },

        seleccionar(index) {
          state.zoomIndex = index;
          this.actualizarModal();
        },

        seleccionarActual() {
          productoManager.seleccionarImagen(state.zoomIndex);
          
          const modal = bootstrap.Modal.getInstance(document.getElementById('modalZoom'));
          if (modal) modal.hide();
          
          productoManager.mostrarAlerta(`‚úÖ Variante seleccionada: "${state.nombresVariantes[state.zoomIndex]}"`, 'success');
        },

        actualizarModal() {
          const modalImagen = document.getElementById('modal-zoom-imagen');
          const miniaturasContainer = document.getElementById('modal-miniaturas');
          
          if (!modalImagen) return;
          
          modalImagen.style.opacity = '0';
          
          setTimeout(() => {
            modalImagen.src = state.imagenes[state.zoomIndex];
            modalImagen.alt = `${state.producto.producto} - ${state.nombresVariantes[state.zoomIndex]}`;
            modalImagen.style.opacity = '1';
            
            document.getElementById('modal-variante-info').textContent = 
              state.nombresVariantes[state.zoomIndex];
            
            // Actualizar miniaturas activas
            if (miniaturasContainer) {
              miniaturasContainer.querySelectorAll('img').forEach((img, index) => {
                img.classList.toggle('border-primary', index === state.zoomIndex);
                img.classList.toggle('border-secondary', index !== state.zoomIndex);
              });
            }
            
            this.actualizarBotonesNavegacion();
          }, 300);
        },

        actualizarBotonesNavegacion() {
          const btnPrev = document.getElementById('btn-prev');
          const btnNext = document.getElementById('btn-next');
          
          if (btnPrev) btnPrev.disabled = state.zoomIndex === 0;
          if (btnNext) btnNext.disabled = state.zoomIndex === state.imagenes.length - 1;
        }
      };

      // ========== CARRITO MANAGER ==========
      const carritoManager = {
        async agregarProducto(producto) {
          try {
            const carrito = JSON.parse(localStorage.getItem('carritoAnmago') || '[]');
            const existeIndex = carrito.findIndex(item => item.id === producto.id);
            
            if (existeIndex > -1) {
              carrito[existeIndex].cantidad += producto.cantidad;
            } else {
              carrito.push(producto);
            }
            
            localStorage.setItem('carritoAnmago', JSON.stringify(carrito));
            this.actualizarContadores();
            
            console.log('‚úÖ Producto agregado al carrito');
            return true;
          } catch (error) {
            console.error('‚ùå Error:', error);
            throw error;
          }
        },

        actualizarContadores() {
          try {
            const carrito = JSON.parse(localStorage.getItem('carritoAnmago') || '[]');
            const totalItems = carrito.reduce((total, item) => total + (item.cantidad || 1), 0);
            
            ['contador-carrito', 'contador-carrito-mobile'].forEach(id => {
              const elemento = document.getElementById(id);
              if (elemento) {
                elemento.textContent = totalItems;
                elemento.style.display = totalItems > 0 ? 'block' : 'none';
              }
            });
          } catch (error) {
            console.error('‚ùå Error actualizando contadores:', error);
          }
        },

        abrirFormularioPedido() {
          window.location.href = 'modalformulario.html';
        }
      };

      // ========== INICIALIZACI√ìN ==========
      document.addEventListener('DOMContentLoaded', () => {
        console.log('üöÄ DOM cargado, iniciando aplicaci√≥n...');
        productoManager.inicializar();
      });

      // ========== API P√öBLICA ==========
      return {
        // M√≥dulos principales
        producto: productoManager,
        carrito: carritoManager,
        zoom: zoomManager,
        navegacion: navegacion,
        promociones: promociones,
        
        // Utilidades
        cache: cache,
        state: state,
        
        // M√©todos globales para onclick
        cambiarCantidad: (delta) => productoManager.cambiarCantidad(delta),
        agregarAlCarrito: () => productoManager.agregarAlCarrito(),
        comprarAhora: () => productoManager.comprarAhora(),
        abrirFormularioPedido: () => carritoManager.abrirFormularioPedido()
      };
    })();
  </script>

  <!-- SCRIPTS ADICIONALES (cargados defer) -->
  <script src="carrito.js?v=20251207" defer></script>
  <script src="app.js?v=20251207" defer></script>
  <script src="buscador.js?v=20251115" defer></script>
</body>
</html>
