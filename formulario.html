<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro Cliente | Anmago Store</title>
  <meta name="description" content="Completa tu registro de cliente para realizar pedidos en Anmago Store">
  
  <!-- Preconexiones optimizadas -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://ik.imagekit.io">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- PWA y favicon -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="logo.jpg" type="image/x-icon" />

  <!-- Bootstrap e iconos -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

  <!-- CSS optimizado -->
  <link rel="stylesheet" href="ESTILO.CSS?v=20251115" />
</head>

<body class="bg-light">
  <!-- HEADER -->
  <div id="header-container"></div>
  
  <!-- BOT√ìN REFRESCAR -->
  <div class="container mt-3">
    <button type="button" class="btn btn-outline-dark" onclick="location.reload()">
      <i class="bi bi-arrow-clockwise"></i> Refrescar
    </button>
    <!-- AGREGAR BOT√ìN DIAGN√ìSTICO -->
    <button type="button" class="btn btn-outline-info ms-2" onclick="diagnosticoFormulario()">
      <i class="bi bi-bug"></i> Diagn√≥stico
    </button>
  </div>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="container py-4">
    <h2 class="mb-4 text-center">Registro Cliente</h2>

    <form id="formCliente">
      <!-- ‚úÖ CAMPO OCULTO CON NAME PARA GOOGLE SHEETS -->
      <input type="hidden" id="clienteId" name="clienteId">

      <!-- Celular principal -->
      <div class="mb-3">
        <label for="telefonoCliente" class="form-label">Celular</label>
        <input type="tel" class="form-control" id="telefonoCliente" name="telefonoCliente" 
               placeholder="Ej: 3001234567" maxlength="10" required>
        <div class="form-text">Debe comenzar por 3 y tener 10 d√≠gitos.</div>
      </div>

      <!-- Nombre -->
      <div class="mb-3">
        <label for="nombreCliente" class="form-label">Nombres y Apellidos</label>
        <input type="text" class="form-control" id="nombreCliente" name="nombreCliente" required>
      </div>

      <!-- Direcci√≥n Completa -->
      <div class="mb-3">
        <label for="DireccionCompleta" class="form-label">Direcci√≥n Completa</label>
        <textarea id="DireccionCompleta" class="form-control" name="DireccionCompleta" 
                  rows="2" maxlength="200" placeholder="Ej: calle, carrera, avenida, transversal, etc." required></textarea>
        <div class="form-text">Recuerda colocar tu direcci√≥n exacta para evitar contratiempos en tu entrega.</div>
      </div>

      <!-- Tipo de Unidad y N√∫mero -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="tipoUnidad" class="form-label">Tipo de unidad</label>
          <select id="tipoUnidad" class="form-select" name="tipoUnidad">
            <option value="">Selecciona</option>
            <option value="Casa">CASA</option>
            <option value="Apartamento">APARTAMENTO</option>
            <option value="Piso">PISO</option>
            <option value="Bodega">BODEGA</option>
            <option value="Interior">INTERIOR</option>
          </select>
        </div>
        <div class="col-md-6">
          <label for="numeroApto" class="form-label">N√∫mero</label>
          <input type="text" class="form-control" id="numeroApto" name="numeroApto" 
                 maxlength="4" inputmode="numeric" pattern="\d{1,4}" title="Solo n√∫meros entre 0 y 9999">
        </div>
      </div>

      <!-- Barrio -->
      <div class="mb-3">
        <label for="barrio" class="form-label">Barrio (opcional)</label>
        <input type="text" class="form-control" id="barrio" name="barrio" maxlength="50">
      </div>

      <!-- Observaci√≥n adicional -->
      <div class="mb-3">
        <label for="observacionDireccion" class="form-label">Punto de referencia</label>
        <textarea id="observacionDireccion" class="form-control" name="observacionDireccion" 
                  rows="2" maxlength="200" placeholder="Ej: entrada por porter√≠a, conjunto.., torre, casa color..., etc."></textarea>
      </div>

      <!-- Ciudad con autocompletado -->
      <div class="mb-3 position-relative">
        <label for="ciudadCliente" class="form-label">Ciudad</label>
        <input type="text" id="ciudadCliente" class="form-control" name="ciudadCliente" 
               placeholder="Escribe tu ciudad" autocomplete="off" required>
        <ul id="sugerenciasCiudades" class="dropdown-menu w-100 mt-0 z-3"></ul>
      </div>

      <!-- Correo electr√≥nico -->
      <div class="mb-3">
        <label for="emailCliente" class="form-label">Correo electr√≥nico</label>
        <input type="email" class="form-control" id="emailCliente" name="emailCliente">
      </div>

      <!-- Bot√≥n Enviar -->
      <div class="text-center mt-4">
        <button id="btnEnviarPedido" class="btn btn-primary btn-lg w-100" disabled>
          <i class="bi bi-send"></i> Enviar pedido
        </button>
      </div>
    </form>
  </main>

  <!-- SCRIPTS EXTERNOS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- VALIDACIONES B√ÅSICAS -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      console.log("üöÄ HTML cargado - Iniciando validaciones b√°sicas...");
      
      // Validaci√≥n de campos num√©ricos
      const camposNumericos = ["telefonoCliente", "numeroApto"];

      camposNumericos.forEach(id => {
        const campo = document.getElementById(id);
        if (!campo) return;

        campo.addEventListener("input", () => {
          const valor = campo.value;
          if (!/^\d*$/.test(valor)) {
            campo.value = valor.replace(/\D/g, "");
          }
        });
      });

      // Validaci√≥n espec√≠fica de tel√©fono
      const campoTelefono = document.getElementById("telefonoCliente");
      if (campoTelefono) {
        campoTelefono.addEventListener("input", () => {
          const valor = campoTelefono.value.trim();
          const esValido = /^3\d{9}$/.test(valor);

          if (!esValido && valor.length === 10) {
            campoTelefono.classList.add("is-invalid");
          } else {
            campoTelefono.classList.remove("is-invalid");
          }
        });
      }

      // Cargar header
      fetch("HEADER.HTML")
        .then(res => res.text())
        .then(header => {
          document.getElementById("header-container").innerHTML = header;
        })
        .catch(error => {
          console.error("Error cargando header:", error);
        });

      // ‚úÖ INICIAL: Deshabilitar todos los campos excepto tel√©fono
      setTimeout(() => {
        const otrosCampos = document.querySelectorAll('#formCliente input:not(#telefonoCliente), #formCliente textarea, #formCliente select');
        otrosCampos.forEach(campo => {
          campo.disabled = true;
          campo.style.opacity = '0.6';
        });
        console.log("üîí Campos deshabilitados (solo tel√©fono activo)");
      }, 100);
    });
  </script>

  <!-- ‚úÖ SCRIPT PRINCIPAL DEL FORMULARIO UNIFICADO -->
  <script src="formulario.js?v=20251115" defer></script>
</body>
</html>
